 name: Deploy to Windows Server 
 on:                                                                                                                                                                                   
    push:                                                                                                                                                                               
      branches: [main]                                                                                                                                                                  
    workflow_dispatch:  # 수동 실행 버튼                                                                                                                                                
                                                                                                                                                                                        
  jobs:                                                                                                                                                                                 
    deploy:                                                                                                                                                                             
      runs-on: self-hosted                                                                                                                                                              
                                                                                                                                                                                        
      defaults:                                                                                                                                                                         
        run:                                                                                                                                                                            
          working-directory: C:\Project\WBSMaster                                                                                                                                       
                                                                                                                                                                                        
      steps:                                                                                                                                                                            
        # 1. 최신 코드 가져오기                                                                                                                                                         
        - name: Pull latest code                                                                                                                                                        
          run: git pull origin main                                                                                                                                                     
                                                                                                                                                                                        
        # 2. 의존성 설치                                                                                                                                                                
        - name: Install dependencies                                                                                                                                                    
          run: npm ci                                                                                                                                                                   
                                                                                                                                                                                        
        # 3. Prisma 클라이언트 생성                                                                                                                                                     
        - name: Generate Prisma Client                                                                                                                                                  
          run: npx prisma generate                                                                                                                                                      
                                                                                                                                                                                        
        # 4. 프로덕션 빌드                                                                                                                                                              
        - name: Build                                                                                                                                                                   
          run: npm run build                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                        
        # 5. PM2로 재시작                                                                                                                                                               
        - name: Restart with PM2                                                                                                                                                        
          run: pm2 restart wbs-master || pm2 start ecosystem.config.js                                                                                                                  
          shell: powershell 
